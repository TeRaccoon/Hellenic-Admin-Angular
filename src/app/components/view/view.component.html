@if (accessible) {
  <div class="container">
    @if (viewMetadata.loaded) {
      <h2>Data for {{ displayName }}</h2>
      <div class="table-container">
        <div class="options-container">
          <div class="row">
            <app-table-buttons
              [data]="tableData!.data"
              [editable]="tableData!.editable"
              [selectedRows]="selectedRows"
              [tableName]="tableName"
            />
          </div>
          <div>
            <app-entry-selector [viewMetadata]="viewMetadata" (loadPage)="pageEvent($event)" />
            <app-table-filter
              [columns]="tableData!.data[0]"
              [dataTypes]="tableData!.types"
              [displayNames]="tableData!.display_names"
              (reloadTable)="reloadTable($event)"
              (clearFilterEmitter)="clearFilterEmitter($event)"
            />
          </div>
        </div>
        @if (tabs.length > 0) {
          <app-table-tabs />
        }
        <div class="table-wrapper">
          @if (tableData!.data && tableData!.data.length > 0) {
            <table>
              <thead>
                @if (tableData!.data[0]) {
                  <tr>
                    <th>Select</th>
                    @for (column of tableData.display_names; track column; let key = $index) {
                      @if (key === 2) {
                        @for (header of getCustomColumnHeadersFromTable(); track header) {
                          <th>{{ header }}</th>
                        }
                      }
                      @if (canDisplayColumn(column.toString())) {
                        <th (click)="sortColumn(column)">
                          {{ column }}
                          @if (this.sortedColumn.columnName === column.toString()) {
                            <fa-icon [icon]="this.sortedColumn.ascending ? ICONS.arrowUp : ICONS.arrowDown" />
                          }
                        </th>
                      }
                    }
                    @if (tableName === TableNames.Items) {
                      <th>Allergen Information</th>
                      <th>Nutrition Information</th>
                    }
                    @if (canDisplayColumn(ExtraColumns.EditRow)) {
                      <th>Edit</th>
                    }
                    @if (canDisplayColumn(ExtraColumns.DeleteRow)) {
                      <th>Delete</th>
                    }
                  </tr>
                }
              </thead>
              <tbody>
                @for (item of filteredDisplayData.slice(0, viewMetadata.entryLimit); track item; let key = $index) {
                  <tr class="data-row">
                    @if (itemContainsFilter(item)) {
                      <td>
                        <input
                          (change)="selectRow($event, item['id'])"
                          type="checkbox"
                          class="checkbox"
                          [checked]="selectedRows.indexOf(item['id']) !== -1"
                        />
                      </td>
                      @for (column of getColumnHeaders(tableData!.data[0]); track column; let columnIndex = $index) {
                        @if (columnIndex === 2 && needsExtraColumn(tableName)) {
                          <app-extra-column
                            [tableName]="tableName"
                            [data]="tableData!.data"
                            [stockData]="stockData"
                            [images]="images"
                            [item]="item"
                            [column]="column"
                          />
                        }
                        @if (canDisplayColumn(column)) {
                          <app-table-data
                            [column]="column"
                            [data]="tableData!.data"
                            [tableName]="tableName"
                            [item]="item"
                            [dataTypes]="tableData!.types"
                            [imageUrlBase]="imageUrlBase"
                            [columnIndex]="columnIndex"
                            (reloadEvent)="reloadTable($event)"
                          />
                        }
                      }
                      @if (tableName === TableNames.Items) {
                        <td (click)="editRow(item['id'], TableNames.AllergenInformation)">
                          <fa-icon [icon]="ICONS.medicalBook"></fa-icon>
                        </td>
                        <td (click)="editRow(item['id'], TableNames.NutritionInfo)">
                          <fa-icon [icon]="ICONS.openBook"></fa-icon>
                        </td>
                      }
                      @if (canDisplayColumn(ExtraColumns.EditRow)) {
                        <td>
                          <a (click)="editRow(item['id'], '')">
                            @if (isEditLoading(item['id'])) {
                              <app-loading-spinner />
                            } @else {
                              <fa-icon [icon]="ICONS.pencil"></fa-icon>
                            }
                          </a>
                        </td>
                      }
                      @if (canDisplayColumn(ExtraColumns.DeleteRow)) {
                        <td class="bin">
                          <a (click)="deleteRow(item['id'])">
                            <fa-icon [icon]="ICONS.bin"></fa-icon>
                          </a>
                        </td>
                      }
                    }
                  </tr>
                }
              </tbody>
            </table>
          } @else {
            @if (tableData!.data.length === 0 && viewMetadata.loaded) {
              <app-no-table-data (addRowEmitter)="addRow(null)" [displayName]="displayName" />
            }
          }
        </div>
        <app-table-footer [viewMetadata]="viewMetadata" [pageRange]="getPageRange()" (loadPage)="pageEvent($event)" />
        @switch (tableName) {
          @case (TableNames.GeneralLedger) {
            <app-ledger-widget></app-ledger-widget>
          }
        }
      </div>
    } @else {
      @if (!viewMetadata.loaded) {
        <div class="loading-container">
          <fa-icon class="loading-icon" [icon]="ICONS.spinner" spinPulse [spin]="true" />
        </div>
      }
    }
    <ng-template #loading>
      @if (!viewMetadata.loaded) {
        <div class="loading-container">
          <fa-icon class="loading-icon" [icon]="ICONS.spinner" spinPulse [spin]="true" />
        </div>
      }
    </ng-template>
  </div>
}
<app-edit-form />
<app-add-form />
<app-delete-form />
<app-message-form />
<app-filter-form />
<app-change-password-form />
<app-widget />
