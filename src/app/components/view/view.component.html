<div class="container">
    <ng-container *ngIf="data && data.length > 0 && loaded else loading">
        <h2>Data for {{ displayName }}</h2>
        <div class="table-container">
            <div class="options-container">
                <div class="row">
                    <button class="button" (click)="addRow()">Add New +</button>
                    <button *ngIf="selectedOption == 'invoices'" class="button" (click)="print()"><fa-icon [icon]="faPrint"/></button>
                </div>
                <div>
                    <p>Show
                        <select (change)="changeEntries($event)">
                            <option value="10">10</option>
                            <option value="25">25</option>
                            <option value="50">50</option>
                            <option value="100">100</option>
                        </select> entries
                    </p>
                    <div class="filter-container">
                        <div *ngIf="queryFilter != null" class="filter" (click)="clearQueryFilter()">
                            <p>{{ queryFilter }}</p>
                            <fa-icon [icon]="faX" />
                        </div>
                        <div *ngIf="columnFilter != null" class="filter" (click)="clearColumnFilter()">
                            <p>{{ columnFilter }}</p>
                            <fa-icon [icon]="faX" />
                        </div>
                        <div *ngIf="tableFilter != null" class="filter" (click)="clearTableFilter()">
                            <p>{{ tableFilter }}</p>
                            <fa-icon [icon]="faX" />
                        </div>
                        <div class="advanced-filter-container">
                            <button class="button" (click)="showAdvancedFilter()"><fa-icon [icon]="faFilter" /></button>
                        </div>
                        <div class="search-container">
                            <form>
                                <input type="text" placeholder="Search..." [(ngModel)]="searchText" name="searchText" />
                                <button type="submit" (click)="setTableFilter()">
                                    <fa-icon [icon]="faSearch"></fa-icon>
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr *ngIf="data[0]">
                            <th>Select</th>
                            <th *ngFor="let column of displayNames">{{ column }}</th>
                            <th>Edit</th>
                            <th>Delete</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="data-row" *ngFor="let item of filteredDisplayData.slice(0, entryLimit); let key = index;">
                            <ng-container *ngIf="itemContainsFilter(item)">
                                <td>
                                    <input (change)="selectRow($event, item['id'])" type="checkbox" class="checkbox">
                                </td>
                                <td *ngFor="let column of getColumnHeaders(data[0]); let columnIndex = index;" [ngClass]="shouldColourCell(item[column])">
                                    <ng-container *ngIf="isColumnBool(columnIndex) else elseBlock">
                                        <input (change)="changeCheckBox($event, key + (currentPage - 1) * entryLimit, column)" type="checkbox" class="checkbox" [checked]="item[column] == 'Yes' ? true : false">
                                    </ng-container>
                                    <ng-template #elseBlock>
                                        <ng-container *ngIf="isColumnImage(columnIndex) else notImage">
                                            <img [src]="'http://localhost/uploads/' + item[column]">
                                        </ng-container>
                                        <ng-template #notImage>
                                            {{ item[column] == null ? '---' : item[column] }}
                                        </ng-template>
                                    </ng-template>
                                </td>
                                <td>
                                    <a (click)="editRow(item.id)">
                                        <fa-icon [icon]="faPencil"></fa-icon>
                                    </a>
                                </td>
                                <td class="bin">
                                    <a (click)="deleteRow(item.id)">
                                        <fa-icon [icon]="faTrashCan"></fa-icon>
                                    </a>
                                </td>
                            </ng-container>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="table-footer">
                <p>Showing page {{ currentPage }} out of {{ pageCount }}</p>
                <div class="page-section">
                    <button (click)="previousPage()">Previous</button>
                    <button [class]="currentPage == 1 ? 'active-page' : ''" (click)="changePage(1)"> {{ 1 }}</button>
                    <button *ngFor="let pageNumber of getPageRange()" (click)="changePage(pageNumber)" [class]="currentPage == pageNumber ? 'active-page' : ''">{{ pageNumber }}</button>
                    <button (click)="nextPage()">Next</button>
                </div>
            </div>
            <ng-container *ngIf="selectedOption == 'general_ledger'">
                <app-ledger-widget></app-ledger-widget>
            </ng-container>
        </div>
    </ng-container>
    <ng-template #loading>
        <ng-container *ngIf="!loaded">
            <div class="loading-container">
                <fa-icon class="loading-icon" [icon]="faSpinner" spinPulse [spin]="true"></fa-icon>
            </div>
        </ng-container>
    </ng-template>
    <div *ngIf="data.length === 0 && loaded" class="alternate-container">
        <h1>Whoops! No data was found for {{ displayName }}!</h1>
        <p>Could this be an error? If so, try refreshing the page otherwise add new data below!</p>
        <button class="button" (click)="addRow()">Add New +</button>
    </div>
</div>
<app-edit-form></app-edit-form>
<app-add-form></app-add-form>
<app-delete-form></app-delete-form>
<app-message-form></app-message-form>
<app-filter-form></app-filter-form>